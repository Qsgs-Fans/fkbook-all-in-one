FreeKill的TODO list
==============================

这里是对FreeKill发展路线的大致规划（大致画饼），以及某些实现思路

如果您有意参与到开发之中，请看 :doc:`../for-devs/join-us` 。

日常：实现新角色新技能，修复已有bug
--------------------------------------

如题。只要会编写拓展技能就能参与！

重置基础UI
------------

所谓的基础UI就是除了游戏内界面的通用UI。也就是无论FreeKill被拿来玩什么游戏，这些ui都是共通的，
具体包括了这些：

- 初始界面

  - 加入服务器
  - 拓展包管理
  - 资源包管理

- 大厅界面

  - 武将一览（这界面真共通？先质疑，但目前算他共通）
  - 卡牌一览
  - 录像回放
  - 个人设置界面
  - 房间创建设置界面
  - 关于界面
  - 玩法规则一览

- 房间内，游戏开始之前的等待界面

（关于那几个一览可能要商讨一下，按最通用的桌游而言无非就是卡牌、棋子、衍生物？）

计划按如同 `Gnome HIG <https://developer.gnome.org/hig/index.html>`_ 中叙述的那样，
重新设计界面UI。应用使用的组件参考 `Adw Widget Gallery <https://gnome.pages.gitlab.gnome.org/libadwaita/doc/main/widget-gallery.html>`_
那样的风格，基于QML的QtQuick Controls重新造轮子，目前造的也还算好。

建议装一个基于Gnome桌面的Linux虚拟机体验一下这样的UI设计风格。
至于游戏内的ui风格因游戏而异。

- 造轮子，复刻Adw组件并拓展一些自己的，作为整个程序通用组件
- 重新设计配置用页面布局，使用造好的轮子拼出设置界面
- 重新设计除了设置界面之外的其他界面
- 完成以上后再看下一步

单独且通用的房间内等待UI
---------------------------

现在的房内等待UI直接复用了新月杀界面，无法满足通用游戏开发需求（并且也并不美观）。
需要单开一个Page做房内等待页。

既然要通用，就不能被新月杀一直以来的UI局限住，可以想办法让房间进入更多玩家之类的。

- 设计等待页的UI（聆听已经绘制了草图）
- 设计新的UI逻辑，以适配当前服务端逻辑

说到UI逻辑那就要考虑到正常进房等人开局、重连与旁观、游戏结束点击回到房间、录像回放这几个场景。
目前的设想是：

- 服务器发来EnterRoom时，UI推入等待页。
- 服务器发来StartGame时，UI动态加载游戏内场景，然后推入该页面
- 旁观和重连时，客户端Lua代码会向ui发出上述两条消息，但是顺序值得商榷
- 回到房间时，弹出游戏页面，重新加载等待页

下一阶段的开发中，若收到StartGame，则根据房间内settings中填写的信息获得要加载的游戏类型，
再完成动态加载。

支持拓展新游戏
-------------------

并非一直以来基于基础新月杀开发游戏模式（UI受很大限制），而是完全不同的游戏。
当然得完成前面几项后才能考虑，因此目前无法列出todo list，只有几点思路，
以下的前提都是基于PVP回合制游戏（FreeKill本来目标就是模拟回合制桌游）：

- 新游戏要支持保存自定义数据，不是每个游戏都保存一模一样的胜率数据
- 没得说，必须支持新的游戏内UI，为此必须完成房间内等待界面开发将新月杀的界面和FreeKill整体界面解耦；必须优化QML代码使得不同的游戏内界面对同一command产生不同效果；需要进一步优化QML文件夹整体组织体系，提高代码重用性以及组织合理性。现在的QML代码差不多就是在乱搞，能跑就行。
- 支持自定义服务端逻辑（现在应该已经能通过派生 ``GameEvent.Game`` 实现自定义服务端逻辑，通过 ``GameMode`` 应用新的服务端游戏逻辑）

先来考虑一下UI方面的拓展性改造需求吧：

- 既然是要拓展游戏类型，那么那个游戏类型应当指定一个自己的游戏内页面，供房间等待页面加载游戏页面。
- 那么，新游戏类型就要能拓展一种全屏的游戏页面。
- 目前唯一的全屏游戏页面就是Room.qml：

  - 页面使用了Qt自带组件和其他Fk提供的组件，以及大量自定义组件
  - 页面还涉及了不少的对话框，供游戏内交互使用
  - 还涉及一些动画效果，这个可以视为某种自定义组件

- 既然要满足能方便的拓展出全屏游戏页面，那么以下几点很重要：

  - Fk本身要提供一个库，包含绝大多数桌游都应当用得上的组件（菜单、聊天、思考计时器等）
  - 游戏类型本身的自定义组件也最好做成不那么耦合的（比如不在组件内部逻辑访问外部内容，如 ``root.parent`` 或者 ``roomScene`` 之类的）、可以在不同游戏类型间通用的
  - 游戏中涉及的对话框，也将较为通用的提取出来（如askForChoice框，这个应当很通用）

具体的重构改造自然要针对Room.qml及其携带的一大堆组件下手了。

为服务端添加Restful接口
---------------------------

至少要等freekill-asio有一个稳定版本后再谈。但我的想法是继续用asio库实现http服务端。

画这个饼的动机是让freekill服务端提供某些实用功能，不单单是运行游戏逻辑，
随便举几个例子，假如你在开发和freekill有关的项目，可能涉及这些需求：

- 获取某串内部码的翻译
- 获取某个素材的URL（或本地路径）
- 查看服务器健康状态
- 管理服务器

如果提供http接口的话，这些需求通过发HTTP Request就能实现，是不是很方便

为服务端打包debian包
--------------------------

如题，我们的文档都默认需要debian，但是每次搭建服务器都要编译，那是不是该弄个deb包最好，
直接 ``sudo dpkg -i xxx.deb`` 就可以了，避免次次编的情况？

首先改造Lua，彻底踢飞 ``QRandomGenerator`` 依赖，让deb包依赖 ``qt6-base`` 的话就烂完了

然后改造服务端本身的代码，考虑服务端的运行方式，因为要运行来源多样的Lua，所以不能推荐用root用户运行，
首先需要添加程序在 ``/usr/bin`` 等系统目录下安装时，新的运行逻辑
（应该也是把数据放 ``~/.local/share/freekill-asio`` 里面再chdir到那里）

然后可以考虑添加一个user级别的systemd单元，简化监控和重启方面？但目前这是不行的，
用systemd启动的服务好像没法访问到CLI，等Restful弄好后可以考虑。

开发搭积木式拓展制作器
--------------------------

详见Repo： https://github.com/qsgs-Fans/fkcreator
